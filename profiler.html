<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profiler - Blender Style UI</title>
  <link rel="stylesheet" href="blender-ui.css">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
    }

    .profiler-layout {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .profiler-main {
      display: flex;
      flex-direction: column;
      flex: 1;
      overflow: hidden;
    }

    .profiler-timeline-area {
      flex: 1;
      display: flex;
      overflow: hidden;
      min-height: 200px;
    }

    .profiler-details {
      height: 200px;
      min-height: 100px;
      max-height: 50vh;
      background-color: var(--bl-bg-base);
      border-top: 1px solid var(--bl-border-dark);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .profiler-details-header {
      display: flex;
      align-items: center;
      height: 26px;
      padding: 0 var(--bl-spacing-md);
      background-color: var(--bl-bg-light);
      border-bottom: 1px solid var(--bl-border-dark);
      gap: var(--bl-spacing-md);
    }

    .profiler-details-title {
      font-size: var(--bl-font-size-base);
      font-weight: 500;
      color: var(--bl-text-primary);
    }

    .profiler-details-content {
      flex: 1;
      overflow: auto;
      padding: var(--bl-spacing-md);
    }

    /* Resize handle */
    .profiler-resize-handle {
      height: 4px;
      background-color: var(--bl-bg-light);
      cursor: ns-resize;
      position: relative;
    }

    .profiler-resize-handle:hover {
      background-color: var(--bl-accent);
    }

    .profiler-resize-handle::after {
      content: "";
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 30px;
      height: 2px;
      background-color: var(--bl-text-muted);
      border-radius: 1px;
    }

    /* Full-height timeline */
    .profiler-timeline-area .bl-timeline {
      flex: 1;
      display: flex;
      flex-direction: column;
      border: none;
      border-radius: 0;
    }

    .profiler-timeline-area .bl-timeline-body {
      flex: 1;
    }

    .profiler-timeline-area .bl-timeline-lanes {
      flex: 1;
    }

    /* Details panel content styling */
    .details-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--bl-spacing-lg);
    }

    .details-section {
      background-color: var(--bl-bg-dark);
      border-radius: var(--bl-radius-md);
      padding: var(--bl-spacing-md);
    }

    .details-section-title {
      font-size: var(--bl-font-size-sm);
      font-weight: 500;
      color: var(--bl-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: var(--bl-spacing-md);
      padding-bottom: var(--bl-spacing-sm);
      border-bottom: 1px solid var(--bl-border-dark);
    }

    .details-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--bl-spacing-xs) 0;
      font-size: var(--bl-font-size-base);
    }

    .details-label {
      color: var(--bl-text-secondary);
    }

    .details-value {
      font-family: var(--bl-font-mono);
      color: var(--bl-text-primary);
    }

    .details-value.highlight {
      color: var(--bl-accent);
    }

    /* Call stack styling */
    .call-stack {
      font-size: var(--bl-font-size-sm);
    }

    .call-stack-item {
      display: flex;
      align-items: center;
      gap: var(--bl-spacing-sm);
      padding: var(--bl-spacing-xs) var(--bl-spacing-sm);
      border-radius: var(--bl-radius-sm);
      cursor: pointer;
    }

    .call-stack-item:hover {
      background-color: var(--bl-bg-light);
    }

    .call-stack-item.current {
      background-color: var(--bl-accent-subtle);
    }

    .call-stack-fn {
      color: var(--bl-text-primary);
      flex: 1;
    }

    .call-stack-file {
      color: var(--bl-text-muted);
      font-family: var(--bl-font-mono);
      font-size: var(--bl-font-size-xs);
    }

    .call-stack-time {
      color: var(--bl-text-secondary);
      font-family: var(--bl-font-mono);
    }

    /* Flame graph bar */
    .flame-bar {
      height: 8px;
      background-color: var(--bl-bg-dark);
      border-radius: var(--bl-radius-sm);
      margin-top: var(--bl-spacing-sm);
      overflow: hidden;
      display: flex;
    }

    .flame-bar-segment {
      height: 100%;
    }
  </style>
</head>
<body class="bl-root">
  <div class="profiler-layout">
    <!-- Header Bar -->
    <header class="bl-header">
      <div class="bl-header-menu">
        <div class="bl-header-menu-item">File</div>
        <div class="bl-header-menu-item">Edit</div>
        <div class="bl-header-menu-item">View</div>
        <div class="bl-header-menu-item">Profile</div>
        <div class="bl-header-menu-item">Window</div>
        <div class="bl-header-menu-item">Help</div>
      </div>
      <div style="margin-left: auto; display: flex; align-items: center; gap: var(--bl-spacing-md);">
        <span class="bl-badge bl-badge-success">Recording</span>
        <button class="bl-btn bl-btn-primary">Stop</button>
      </div>
    </header>

    <!-- Main Profiler Area -->
    <main class="profiler-main">
      <!-- Timeline Area -->
      <div class="profiler-timeline-area">
        <div class="bl-timeline">
          <!-- Timeline Header -->
          <div class="bl-timeline-header">
            <span class="bl-timeline-title">Frame Profile - Frame #1247</span>
            <div class="bl-btn-group">
              <button class="bl-btn bl-btn-icon bl-tooltip" data-tooltip="Previous Frame">
                <svg viewBox="0 0 16 16" fill="currentColor"><path d="M11 3L5 8l6 5V3z"/><rect x="3" y="3" width="2" height="10"/></svg>
              </button>
              <button class="bl-btn bl-btn-icon bl-tooltip" data-tooltip="Next Frame">
                <svg viewBox="0 0 16 16" fill="currentColor"><path d="M5 3l6 5-6 5V3z"/><rect x="11" y="3" width="2" height="10"/></svg>
              </button>
            </div>
            <div class="bl-timeline-controls">
              <div class="bl-select">
                <select>
                  <option>All Threads</option>
                  <option>Main Thread</option>
                  <option>GPU</option>
                  <option>Workers</option>
                </select>
              </div>
              <div class="bl-timeline-zoom">
                <button class="bl-btn bl-btn-icon bl-tooltip" data-tooltip="Zoom Out">
                  <svg viewBox="0 0 16 16" fill="currentColor"><rect x="3" y="7" width="10" height="2"/></svg>
                </button>
                <span>100%</span>
                <button class="bl-btn bl-btn-icon bl-tooltip" data-tooltip="Zoom In">
                  <svg viewBox="0 0 16 16" fill="currentColor"><rect x="3" y="7" width="10" height="2"/><rect x="7" y="3" width="2" height="10"/></svg>
                </button>
              </div>
              <button class="bl-btn bl-btn-icon bl-tooltip" data-tooltip="Fit to Window">
                <svg viewBox="0 0 16 16" fill="currentColor"><path d="M2 2h4v2H4v2H2V2zm8 0h4v4h-2V4h-2V2zM4 10H2v4h4v-2H4v-2zm8 2v2h-2v2h4v-4h-2z"/></svg>
              </button>
              <button class="bl-btn bl-btn-icon bl-tooltip" data-tooltip="Toggle Theme" onclick="document.body.classList.toggle('bl-theme-light')">
                <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 12.5V2.5a5.5 5.5 0 0 1 0 11z"/></svg>
              </button>
            </div>
          </div>

          <!-- Timeline Body -->
          <div class="bl-timeline-body">
            <!-- Ruler Row: Tracks Label + Time Ruler -->
            <div class="bl-timeline-ruler-row">
              <div class="bl-timeline-tracks-header">
                <span>Tracks</span>
              </div>
              <div class="bl-timeline-ruler">
                <div class="bl-timeline-ruler-inner">
                  <div class="bl-timeline-ruler-mark major" style="left: 0;"><span>0ms</span></div>
                  <div class="bl-timeline-ruler-mark" style="left: 6.25%;"></div>
                  <div class="bl-timeline-ruler-mark major" style="left: 12.5%;"><span>2ms</span></div>
                  <div class="bl-timeline-ruler-mark" style="left: 18.75%;"></div>
                  <div class="bl-timeline-ruler-mark major" style="left: 25%;"><span>4ms</span></div>
                  <div class="bl-timeline-ruler-mark" style="left: 31.25%;"></div>
                  <div class="bl-timeline-ruler-mark major" style="left: 37.5%;"><span>6ms</span></div>
                  <div class="bl-timeline-ruler-mark" style="left: 43.75%;"></div>
                  <div class="bl-timeline-ruler-mark major" style="left: 50%;"><span>8ms</span></div>
                  <div class="bl-timeline-ruler-mark" style="left: 56.25%;"></div>
                  <div class="bl-timeline-ruler-mark major" style="left: 62.5%;"><span>10ms</span></div>
                  <div class="bl-timeline-ruler-mark" style="left: 68.75%;"></div>
                  <div class="bl-timeline-ruler-mark major" style="left: 75%;"><span>12ms</span></div>
                  <div class="bl-timeline-ruler-mark" style="left: 81.25%;"></div>
                  <div class="bl-timeline-ruler-mark major" style="left: 87.5%;"><span>14ms</span></div>
                  <div class="bl-timeline-ruler-mark" style="left: 93.75%;"></div>
                  <div class="bl-timeline-ruler-mark major" style="left: 100%;"><span>16ms</span></div>
                </div>
              </div>
            </div>

            <!-- Scrollable Area: Tracks + Lanes -->
            <div class="bl-timeline-scroll">
              <!-- Track Shells Column -->
              <div class="bl-timeline-tracks">
                <!-- Main Thread Group -->
                <div class="bl-track-group" data-group="main-thread">
                  <div class="bl-track-group-header" onclick="toggleTrackGroup(this, 'main-thread')">
                    <div class="bl-track-group-toggle">
                      <svg viewBox="0 0 10 10"><path d="M2 1 L8 5 L2 9 Z"/></svg>
                    </div>
                    <span class="bl-track-group-name">Main Thread</span>
                    <div class="bl-track-buttons">
                      <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button>
                      <button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                    </div>
                  </div>
                  <div class="bl-track-group-content">
                    <!-- Frame Track (expandable) -->
                    <div class="bl-track expandable" data-track="frame" data-depth="1" onclick="toggleTrack(this, 'frame')">
                      <div class="bl-track-toggle">
                        <svg viewBox="0 0 10 10"><path d="M2 1 L8 5 L2 9 Z"/></svg>
                      </div>
                      <span class="bl-track-name">Frame</span>
                      <div class="bl-track-buttons">
                        <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()">
                          <svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg>
                        </button>
                        <button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()">
                          <svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg>
                        </button>
                      </div>
                    </div>
                    <div class="bl-track-children" data-track="frame">
                      <!-- Scripts Track (expandable) -->
                      <div class="bl-track expandable" data-track="scripts" data-depth="2" onclick="toggleTrack(this, 'scripts')">
                        <div class="bl-track-toggle">
                          <svg viewBox="0 0 10 10"><path d="M2 1 L8 5 L2 9 Z"/></svg>
                        </div>
                        <span class="bl-track-name">Scripts</span>
                        <div class="bl-track-buttons">
                          <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button><button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                        </div>
                      </div>
                      <div class="bl-track-children" data-track="scripts">
                        <div class="bl-track bl-tooltip" data-depth="3" data-tooltip="updateSceneWithComplexTransformationsAndPhysicsCalculations()">
                          <span class="bl-track-name">updateSceneWithComplexTransformationsAndPhysicsCalculations()</span>
                          <div class="bl-track-buttons">
                            <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button>
                            <button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                          </div>
                        </div>
                        <div class="bl-track bl-tooltip" data-depth="3" data-tooltip="processUserInputEventsFromKeyboardMouseAndGamepad()">
                          <span class="bl-track-name">processUserInputEventsFromKeyboardMouseAndGamepad()</span>
                          <div class="bl-track-buttons">
                            <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button>
                            <button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                          </div>
                        </div>
                        <div class="bl-track bl-tooltip" data-depth="3" data-tooltip="AnimationController::updateAllActiveAnimationsAndBlendTrees">
                          <span class="bl-track-name">AnimationController::updateAllActiveAnimationsAndBlendTrees</span>
                          <div class="bl-track-buttons">
                            <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button>
                            <button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                          </div>
                        </div>
                        <div class="bl-track bl-tooltip" data-depth="3" data-tooltip="WebGLRenderingContext.drawElementsInstancedANGLE">
                          <span class="bl-track-name">WebGLRenderingContext.drawElementsInstancedANGLE</span>
                          <div class="bl-track-buttons">
                            <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button>
                            <button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                          </div>
                        </div>
                      </div>
                      <!-- Layout Track -->
                      <div class="bl-track" data-depth="2">
                        <span class="bl-track-name">Layout</span>
                        <div class="bl-track-buttons">
                          <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button><button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                        </div>
                      </div>
                      <!-- Paint Track (expandable) -->
                      <div class="bl-track expandable" data-track="paint" data-depth="2" onclick="toggleTrack(this, 'paint')">
                        <div class="bl-track-toggle">
                          <svg viewBox="0 0 10 10"><path d="M2 1 L8 5 L2 9 Z"/></svg>
                        </div>
                        <span class="bl-track-name">Paint</span>
                        <div class="bl-track-buttons">
                          <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button><button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                        </div>
                      </div>
                      <div class="bl-track-children" data-track="paint">
                        <div class="bl-track" data-depth="3">
                          <span class="bl-track-name">paint</span>
                        </div>
                        <div class="bl-track" data-depth="3">
                          <span class="bl-track-name">rasterize</span>
                        </div>
                      </div>
                      <!-- Composite Track -->
                      <div class="bl-track" data-depth="2">
                        <span class="bl-track-name">Composite</span>
                        <div class="bl-track-buttons">
                          <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button><button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- GPU Group -->
                <div class="bl-track-group" data-group="gpu">
                  <div class="bl-track-group-header" onclick="toggleTrackGroup(this, 'gpu')">
                    <div class="bl-track-group-toggle">
                      <svg viewBox="0 0 10 10"><path d="M2 1 L8 5 L2 9 Z"/></svg>
                    </div>
                    <span class="bl-track-group-name">GPU</span>
                    <div class="bl-track-buttons">
                      <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button>
                      <button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                    </div>
                  </div>
                  <div class="bl-track-group-content">
                    <div class="bl-track">
                      <span class="bl-track-name">Render Pass</span>
                      <div class="bl-track-buttons">
                        <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button><button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                        
                      </div>
                    </div>
                    <div class="bl-track">
                      <span class="bl-track-name">Compositing</span>
                      <div class="bl-track-buttons">
                        <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button><button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                        
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Worker Threads Group -->
                <div class="bl-track-group" data-group="workers">
                  <div class="bl-track-group-header" onclick="toggleTrackGroup(this, 'workers')">
                    <div class="bl-track-group-toggle">
                      <svg viewBox="0 0 10 10"><path d="M2 1 L8 5 L2 9 Z"/></svg>
                    </div>
                    <span class="bl-track-group-name">Worker Threads</span>
                    <div class="bl-track-buttons">
                      <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button>
                      <button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                    </div>
                  </div>
                  <div class="bl-track-group-content">
                    <div class="bl-track">
                      <span class="bl-track-name">Worker 1</span>
                      <div class="bl-track-buttons">
                        <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button><button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                      </div>
                    </div>
                    <div class="bl-track">
                      <span class="bl-track-name">Worker 2</span>
                      <div class="bl-track-buttons">
                        <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button><button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                      </div>
                    </div>
                    <div class="bl-track">
                      <span class="bl-track-name">Worker 3</span>
                      <div class="bl-track-buttons">
                        <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button><button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                      </div>
                    </div>
                    <div class="bl-track">
                      <span class="bl-track-name">Worker 4</span>
                      <div class="bl-track-buttons">
                        <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button><button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Network Group -->
                <div class="bl-track-group collapsed" data-group="network">
                  <div class="bl-track-group-header" onclick="toggleTrackGroup(this, 'network')">
                    <div class="bl-track-group-toggle">
                      <svg viewBox="0 0 10 10"><path d="M2 1 L8 5 L2 9 Z"/></svg>
                    </div>
                    <span class="bl-track-group-name">Network</span>
                    <div class="bl-track-buttons">
                      <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button>
                      <button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                    </div>
                  </div>
                  <div class="bl-track-group-content">
                    <div class="bl-track">
                      <span class="bl-track-name">XHR</span>
                      <div class="bl-track-buttons">
                        <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button><button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                      </div>
                    </div>
                    <div class="bl-track">
                      <span class="bl-track-name">Fetch</span>
                      <div class="bl-track-buttons">
                        <button class="bl-track-btn bl-tooltip" data-tooltip="Pin" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><path d="M10 1L7 4 4.5 3.5 2 6l3.5 2L2 14l6-3.5L10.5 14 13 11.5 12.5 9l3-3z"/></svg></button><button class="bl-track-btn bl-tooltip" data-tooltip="More" onclick="event.stopPropagation()"><svg viewBox="0 0 16 16"><circle cx="8" cy="3" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="8" cy="13" r="1.5"/></svg></button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Lanes Column -->
              <div class="bl-timeline-lanes-column">
                <div class="bl-timeline-lanes-inner" style="width: 100%; min-height: 100%;">
                  <!-- Grid Lines -->
                  <div class="bl-timeline-grid">
                    <div class="bl-timeline-grid-line major" style="left: 0;"></div>
                    <div class="bl-timeline-grid-line" style="left: 6.25%;"></div>
                    <div class="bl-timeline-grid-line major" style="left: 12.5%;"></div>
                    <div class="bl-timeline-grid-line" style="left: 18.75%;"></div>
                    <div class="bl-timeline-grid-line major" style="left: 25%;"></div>
                    <div class="bl-timeline-grid-line" style="left: 31.25%;"></div>
                    <div class="bl-timeline-grid-line major" style="left: 37.5%;"></div>
                    <div class="bl-timeline-grid-line" style="left: 43.75%;"></div>
                    <div class="bl-timeline-grid-line major" style="left: 50%;"></div>
                    <div class="bl-timeline-grid-line" style="left: 56.25%;"></div>
                    <div class="bl-timeline-grid-line major" style="left: 62.5%;"></div>
                    <div class="bl-timeline-grid-line" style="left: 68.75%;"></div>
                    <div class="bl-timeline-grid-line major" style="left: 75%;"></div>
                    <div class="bl-timeline-grid-line" style="left: 81.25%;"></div>
                    <div class="bl-timeline-grid-line major" style="left: 87.5%;"></div>
                    <div class="bl-timeline-grid-line" style="left: 93.75%;"></div>
                  </div>

                  <!-- Playhead -->
                  <div class="bl-timeline-playhead" style="left: 32%;"></div>

                  <!-- Main Thread Lane Group -->
                  <div class="bl-lane-group" data-group="main-thread">
                    <div class="bl-lane-group-header"></div>
                    <div class="bl-lane-group-content">
                      <!-- Frame Lane -->
                      <div class="bl-timeline-lane">
                        <div class="bl-slice bl-slice-blue" style="left: 1%; width: 98%;" onclick="selectSlice(this, 'requestAnimationFrame', '16.4ms', 'Frame callback')">
                          <span class="bl-slice-label">requestAnimationFrame</span>
                          <span class="bl-slice-duration">16.4ms</span>
                        </div>
                      </div>
                      <div class="bl-lane-children" data-track="frame">
                        <!-- Scripts Lane -->
                        <div class="bl-timeline-lane">
                          <div class="bl-slice bl-slice-green" style="left: 2%; width: 50%;" onclick="selectSlice(this, 'Scripts', '8.2ms', 'All scripts')">
                            <span class="bl-slice-label">Scripts</span>
                            <span class="bl-slice-duration">8.2ms</span>
                          </div>
                        </div>
                        <div class="bl-lane-children" data-track="scripts">
                          <!-- Individual script function lanes -->
                          <div class="bl-timeline-lane">
                            <div class="bl-slice bl-slice-green" style="left: 2%; width: 22%;" onclick="selectSlice(this, 'updateScene()', '3.5ms', 'scene.js:142')">
                              <span class="bl-slice-label">updateScene()</span>
                              <span class="bl-slice-duration">3.5ms</span>
                            </div>
                          </div>
                          <div class="bl-timeline-lane">
                            <div class="bl-slice bl-slice-green" style="left: 26%; width: 15%;" onclick="selectSlice(this, 'processInput()', '2.4ms', 'input.js:89')">
                              <span class="bl-slice-label">processInput()</span>
                              <span class="bl-slice-duration">2.4ms</span>
                            </div>
                          </div>
                          <div class="bl-timeline-lane selected">
                            <div class="bl-slice bl-slice-green selected" style="left: 43%; width: 8%;" onclick="selectSlice(this, 'animate()', '1.3ms', 'animation.js:201')">
                              <span class="bl-slice-label">animate()</span>
                              <span class="bl-slice-duration">1.3ms</span>
                            </div>
                          </div>
                          <div class="bl-timeline-lane">
                            <div class="bl-slice bl-slice-green" style="left: 53%; width: 6%;" onclick="selectSlice(this, 'render()', '1.0ms', 'renderer.js:55')">
                              <span class="bl-slice-label">render()</span>
                            </div>
                          </div>
                        </div>
                        <!-- Layout Lane -->
                        <div class="bl-timeline-lane">
                          <div class="bl-slice bl-slice-orange" style="left: 60%; width: 13%;" onclick="selectSlice(this, 'recalcStyle', '2.1ms', 'Browser')">
                            <span class="bl-slice-label">recalcStyle</span>
                            <span class="bl-slice-duration">2.1ms</span>
                          </div>
                        </div>
                        <!-- Paint Lane -->
                        <div class="bl-timeline-lane">
                          <div class="bl-slice bl-slice-purple" style="left: 75%; width: 12%;" onclick="selectSlice(this, 'Paint', '1.8ms', 'Browser')">
                            <span class="bl-slice-label">Paint</span>
                            <span class="bl-slice-duration">1.8ms</span>
                          </div>
                        </div>
                        <div class="bl-lane-children" data-track="paint">
                          <div class="bl-timeline-lane">
                            <div class="bl-slice bl-slice-purple" style="left: 75%; width: 6%;" onclick="selectSlice(this, 'paint', '1.0ms', 'Browser')">
                              <span class="bl-slice-label">paint</span>
                            </div>
                          </div>
                          <div class="bl-timeline-lane">
                            <div class="bl-slice bl-slice-purple" style="left: 82%; width: 5%;" onclick="selectSlice(this, 'rasterize', '0.8ms', 'Browser')">
                              <span class="bl-slice-label">raster</span>
                            </div>
                          </div>
                        </div>
                        <!-- Composite Lane -->
                        <div class="bl-timeline-lane">
                          <div class="bl-slice bl-slice-green" style="left: 88%; width: 5%; background-color: #6a8a6a;" onclick="selectSlice(this, 'composite', '0.8ms', 'Browser')">
                            <span class="bl-slice-label">composite</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- GPU Lane Group -->
                  <div class="bl-lane-group" data-group="gpu">
                    <div class="bl-lane-group-header"></div>
                    <div class="bl-lane-group-content">
                      <!-- Render Pass Lane -->
                      <div class="bl-timeline-lane">
                        <div class="bl-slice bl-slice-red" style="left: 3%; width: 18%;" onclick="selectSlice(this, 'drawScene', '2.9ms', 'GPU')">
                          <span class="bl-slice-label">drawScene</span>
                          <span class="bl-slice-duration">2.9ms</span>
                        </div>
                        <div class="bl-slice bl-slice-red" style="left: 23%; width: 14%;" onclick="selectSlice(this, 'drawShadows', '2.2ms', 'GPU')">
                          <span class="bl-slice-label">drawShadows</span>
                          <span class="bl-slice-duration">2.2ms</span>
                        </div>
                        <div class="bl-slice bl-slice-red" style="left: 39%; width: 12%;" onclick="selectSlice(this, 'drawTransparent', '1.9ms', 'GPU')">
                          <span class="bl-slice-label">drawTransparent</span>
                        </div>
                        <div class="bl-slice bl-slice-red" style="left: 53%; width: 8%;" onclick="selectSlice(this, 'drawUI', '1.4ms', 'GPU')">
                          <span class="bl-slice-label">drawUI</span>
                        </div>
                      </div>

                      <!-- Compositing Lane -->
                      <div class="bl-timeline-lane">
                        <div class="bl-slice bl-slice-teal" style="left: 63%; width: 10%;" onclick="selectSlice(this, 'bloom', '1.6ms', 'GPU Post')">
                          <span class="bl-slice-label">bloom</span>
                          <span class="bl-slice-duration">1.6ms</span>
                        </div>
                        <div class="bl-slice bl-slice-teal" style="left: 74%; width: 7%;" onclick="selectSlice(this, 'tonemap', '1.1ms', 'GPU Post')">
                          <span class="bl-slice-label">tonemap</span>
                        </div>
                        <div class="bl-slice bl-slice-teal" style="left: 82%; width: 6%;" onclick="selectSlice(this, 'fxaa', '1.0ms', 'GPU Post')">
                          <span class="bl-slice-label">fxaa</span>
                        </div>
                        <div class="bl-slice bl-slice-teal" style="left: 89%; width: 5%;" onclick="selectSlice(this, 'present', '0.7ms', 'GPU')">
                          <span class="bl-slice-label">present</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Worker Threads Lane Group -->
                  <div class="bl-lane-group" data-group="workers">
                    <div class="bl-lane-group-header"></div>
                    <div class="bl-lane-group-content">
                      <!-- Worker 1 Lane -->
                      <div class="bl-timeline-lane">
                        <div class="bl-slice bl-slice-yellow" style="left: 5%; width: 12%;" onclick="selectSlice(this, 'parseGeometry', '1.9ms', 'worker1.js')">
                          <span class="bl-slice-label">parseGeometry</span>
                        </div>
                        <div class="bl-slice bl-slice-yellow" style="left: 35%; width: 8%;" onclick="selectSlice(this, 'buildBVH', '1.3ms', 'worker1.js')">
                          <span class="bl-slice-label">buildBVH</span>
                        </div>
                      </div>

                      <!-- Worker 2 Lane -->
                      <div class="bl-timeline-lane">
                        <div class="bl-slice bl-slice-yellow" style="left: 8%; width: 10%;" onclick="selectSlice(this, 'decodeTexture', '1.6ms', 'worker2.js')">
                          <span class="bl-slice-label">decodeTexture</span>
                        </div>
                        <div class="bl-slice bl-slice-yellow" style="left: 45%; width: 7%;" onclick="selectSlice(this, 'compress', '1.2ms', 'worker2.js')">
                          <span class="bl-slice-label">compress</span>
                        </div>
                      </div>

                      <!-- Worker 3 Lane -->
                      <div class="bl-timeline-lane">
                        <div class="bl-slice bl-slice-yellow" style="left: 12%; width: 6%;" onclick="selectSlice(this, 'loadAsset', '0.9ms', 'worker3.js')">
                          <span class="bl-slice-label">loadAsset</span>
                        </div>
                        <div class="bl-slice bl-slice-yellow" style="left: 25%; width: 4%;" onclick="selectSlice(this, 'parse', '0.6ms', 'worker3.js')">
                          <span class="bl-slice-label">parse</span>
                        </div>
                      </div>

                      <!-- Worker 4 Lane -->
                      <div class="bl-timeline-lane">
                        <div class="bl-slice bl-slice-yellow" style="left: 15%; width: 9%;" onclick="selectSlice(this, 'physics', '1.4ms', 'worker4.js')">
                          <span class="bl-slice-label">physics</span>
                        </div>
                        <div class="bl-slice bl-slice-yellow" style="left: 50%; width: 5%;" onclick="selectSlice(this, 'collision', '0.7ms', 'worker4.js')">
                          <span class="bl-slice-label">collision</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Network Lane Group (Collapsed) -->
                  <div class="bl-lane-group collapsed" data-group="network">
                    <div class="bl-lane-group-header"></div>
                    <div class="bl-lane-group-content">
                      <div class="bl-timeline-lane">
                        <div class="bl-slice bl-slice-pink" style="left: 10%; width: 30%;">
                          <span class="bl-slice-label">GET /api/data</span>
                        </div>
                      </div>
                      <div class="bl-timeline-lane">
                        <div class="bl-slice bl-slice-pink" style="left: 20%; width: 50%;">
                          <span class="bl-slice-label">GET /assets/model.glb</span>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </div><!-- /bl-timeline-scroll -->
          </div><!-- /bl-timeline-body -->

          <!-- Timeline Stats -->
          <div class="bl-timeline-stats">
            <div class="bl-timeline-stat">
              <span class="bl-timeline-stat-label">Frame:</span>
              <span class="bl-timeline-stat-value">#1247</span>
            </div>
            <div class="bl-timeline-stat">
              <span class="bl-timeline-stat-label">Time:</span>
              <span class="bl-timeline-stat-value">16.4ms</span>
            </div>
            <div class="bl-timeline-stat">
              <span class="bl-timeline-stat-label">FPS:</span>
              <span class="bl-timeline-stat-value">61</span>
            </div>
            <div class="bl-timeline-stat">
              <span class="bl-timeline-stat-label">CPU:</span>
              <span class="bl-timeline-stat-value">12.1ms</span>
            </div>
            <div class="bl-timeline-stat">
              <span class="bl-timeline-stat-label">GPU:</span>
              <span class="bl-timeline-stat-value">12.8ms</span>
            </div>
            <div class="bl-timeline-stat">
              <span class="bl-timeline-stat-label">Selected:</span>
              <span class="bl-timeline-stat-value" style="color: var(--bl-accent);" id="selectedSliceStat">animate() - 1.3ms</span>
            </div>
          </div>

          <!-- Timeline Minimap -->
          <div class="bl-timeline-minimap">
            <div class="bl-timeline-minimap-slice" style="left: 2%; width: 50%; top: 4px; background-color: #5a9a5a;"></div>
            <div class="bl-timeline-minimap-slice" style="left: 60%; width: 15%; top: 8px; background-color: #d4842a;"></div>
            <div class="bl-timeline-minimap-slice" style="left: 75%; width: 18%; top: 12px; background-color: #8a6ab5;"></div>
            <div class="bl-timeline-minimap-slice" style="left: 3%; width: 60%; top: 18px; background-color: #b54a4a;"></div>
            <div class="bl-timeline-minimap-slice" style="left: 63%; width: 32%; top: 22px; background-color: #4a9a9a;"></div>
            <div class="bl-timeline-minimap-viewport" style="left: 0%; width: 100%;"></div>
          </div>
        </div>
      </div>

      <!-- Resize Handle -->
      <div class="profiler-resize-handle" id="resizeHandle"></div>

      <!-- Details Panel -->
      <div class="profiler-details" id="detailsPanel">
        <div class="profiler-details-header">
          <span class="profiler-details-title">Selection Details</span>
          <div class="bl-tabs" style="margin-left: var(--bl-spacing-lg); border: none;">
            <button class="bl-tab active" onclick="switchDetailsTab(this, 'summary')">Summary</button>
            <button class="bl-tab" onclick="switchDetailsTab(this, 'callstack')">Call Stack</button>
            <button class="bl-tab" onclick="switchDetailsTab(this, 'flamegraph')">Flame Graph</button>
          </div>
          <div style="margin-left: auto;">
            <button class="bl-btn bl-btn-icon" onclick="document.getElementById('detailsPanel').style.display='none'">
              <svg viewBox="0 0 16 16" fill="currentColor"><path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="2"/></svg>
            </button>
          </div>
        </div>
        <div class="profiler-details-content">
          <!-- Summary Tab -->
          <div id="tab-summary" class="details-grid">
            <div class="details-section">
              <div class="details-section-title">Selected Slice</div>
              <div class="details-row">
                <span class="details-label">Function</span>
                <span class="details-value highlight" id="detailFn">animate()</span>
              </div>
              <div class="details-row">
                <span class="details-label">Duration</span>
                <span class="details-value" id="detailDuration">1.3ms</span>
              </div>
              <div class="details-row">
                <span class="details-label">Self Time</span>
                <span class="details-value">0.4ms</span>
              </div>
              <div class="details-row">
                <span class="details-label">Source</span>
                <span class="details-value" id="detailSource">animation.js:201</span>
              </div>
              <div class="details-row">
                <span class="details-label">Start</span>
                <span class="details-value">5.12ms</span>
              </div>
              <div class="details-row">
                <span class="details-label">End</span>
                <span class="details-value">6.42ms</span>
              </div>
            </div>

            <div class="details-section">
              <div class="details-section-title">Frame Statistics</div>
              <div class="details-row">
                <span class="details-label">Total Frame Time</span>
                <span class="details-value">16.4ms</span>
              </div>
              <div class="details-row">
                <span class="details-label">Scripts</span>
                <span class="details-value">8.2ms (50%)</span>
              </div>
              <div class="details-row">
                <span class="details-label">Layout</span>
                <span class="details-value">2.1ms (13%)</span>
              </div>
              <div class="details-row">
                <span class="details-label">Paint</span>
                <span class="details-value">1.8ms (11%)</span>
              </div>
              <div class="details-row">
                <span class="details-label">GPU</span>
                <span class="details-value">12.8ms</span>
              </div>
              <div class="flame-bar">
                <div class="flame-bar-segment" style="width: 50%; background-color: #5a9a5a;"></div>
                <div class="flame-bar-segment" style="width: 13%; background-color: #d4842a;"></div>
                <div class="flame-bar-segment" style="width: 11%; background-color: #8a6ab5;"></div>
                <div class="flame-bar-segment" style="width: 5%; background-color: #6a8a6a;"></div>
                <div class="flame-bar-segment" style="width: 21%; background-color: #424242;"></div>
              </div>
            </div>

            <div class="details-section">
              <div class="details-section-title">Warnings</div>
              <div class="details-row" style="color: var(--bl-warning);">
                <span>Long frame detected (>16ms budget)</span>
              </div>
              <div class="details-row" style="color: var(--bl-text-secondary);">
                <span>Consider optimizing updateScene()</span>
              </div>
            </div>
          </div>

          <!-- Call Stack Tab (hidden by default) -->
          <div id="tab-callstack" style="display: none;">
            <div class="details-section" style="max-width: 600px;">
              <div class="details-section-title">Call Stack</div>
              <div class="call-stack">
                <div class="call-stack-item current">
                  <span class="call-stack-fn">animate()</span>
                  <span class="call-stack-file">animation.js:201</span>
                  <span class="call-stack-time">1.3ms</span>
                </div>
                <div class="call-stack-item">
                  <span class="call-stack-fn">updateTransforms()</span>
                  <span class="call-stack-file">animation.js:145</span>
                  <span class="call-stack-time">0.6ms</span>
                </div>
                <div class="call-stack-item">
                  <span class="call-stack-fn">interpolate()</span>
                  <span class="call-stack-file">animation.js:89</span>
                  <span class="call-stack-time">0.3ms</span>
                </div>
                <div class="call-stack-item">
                  <span class="call-stack-fn">requestAnimationFrame callback</span>
                  <span class="call-stack-file">main.js:42</span>
                  <span class="call-stack-time">16.4ms</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Flame Graph Tab (hidden by default) -->
          <div id="tab-flamegraph" style="display: none;">
            <div class="details-section">
              <div class="details-section-title">Flame Graph (Top-Down)</div>
              <p style="color: var(--bl-text-muted); font-size: var(--bl-font-size-sm);">
                Interactive flame graph visualization would appear here, showing hierarchical function calls with width proportional to time spent.
              </p>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Status Bar -->
    <footer class="bl-statusbar">
      <span class="bl-statusbar-item">Frame: 1247</span>
      <span class="bl-statusbar-item">Duration: 16.4ms</span>
      <span class="bl-statusbar-item">60 FPS target</span>
      <span class="bl-statusbar-item" style="margin-left: auto; border-right: none;">Profiler v1.0</span>
    </footer>
  </div>

  <script>
    // Track group toggle functionality - syncs both track and lane groups
    function toggleTrackGroup(header, groupId) {
      const trackGroup = header.parentElement;
      const laneGroup = document.querySelector(`.bl-lane-group[data-group="${groupId}"]`);

      trackGroup.classList.toggle('collapsed');
      if (laneGroup) {
        laneGroup.classList.toggle('collapsed');
      }
    }

    // Individual track toggle functionality - syncs track children with lane children
    function toggleTrack(trackElement, trackId) {
      // Toggle collapsed state on the track
      trackElement.classList.toggle('collapsed');
      const isCollapsed = trackElement.classList.contains('collapsed');

      // Find and toggle the track's children container
      const trackChildren = trackElement.nextElementSibling;
      if (trackChildren && trackChildren.classList.contains('bl-track-children') && trackChildren.dataset.track === trackId) {
        if (isCollapsed) {
          trackChildren.style.display = 'none';
        } else {
          trackChildren.style.display = '';
        }
      }

      // Find and toggle the corresponding lane children
      const laneChildren = document.querySelector(`.bl-lane-children[data-track="${trackId}"]`);
      if (laneChildren) {
        if (isCollapsed) {
          laneChildren.classList.add('collapsed');
        } else {
          laneChildren.classList.remove('collapsed');
        }
      }
    }

    // Slice selection
    function selectSlice(element, name, duration, source) {
      // Remove previous selection
      document.querySelectorAll('.bl-slice').forEach(s => s.classList.remove('selected'));
      element.classList.add('selected');

      // Update details panel
      document.getElementById('detailFn').textContent = name;
      document.getElementById('detailDuration').textContent = duration;
      document.getElementById('detailSource').textContent = source;
      document.getElementById('selectedSliceStat').textContent = `${name} - ${duration}`;
    }

    // Details tab switching
    function switchDetailsTab(tab, tabId) {
      // Update tab buttons
      tab.parentElement.querySelectorAll('.bl-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');

      // Show/hide tab content
      document.getElementById('tab-summary').style.display = tabId === 'summary' ? 'grid' : 'none';
      document.getElementById('tab-callstack').style.display = tabId === 'callstack' ? 'block' : 'none';
      document.getElementById('tab-flamegraph').style.display = tabId === 'flamegraph' ? 'block' : 'none';
    }

    // Resize handle for details panel
    const resizeHandle = document.getElementById('resizeHandle');
    const detailsPanel = document.getElementById('detailsPanel');
    let isResizing = false;

    resizeHandle.addEventListener('mousedown', function(e) {
      isResizing = true;
      document.body.style.cursor = 'ns-resize';
      document.body.style.userSelect = 'none';
    });

    document.addEventListener('mousemove', function(e) {
      if (!isResizing) return;

      const containerRect = document.querySelector('.profiler-main').getBoundingClientRect();
      const newHeight = containerRect.bottom - e.clientY;

      if (newHeight >= 100 && newHeight <= window.innerHeight * 0.5) {
        detailsPanel.style.height = newHeight + 'px';
      }
    });

    document.addEventListener('mouseup', function() {
      isResizing = false;
      document.body.style.cursor = '';
      document.body.style.userSelect = '';
    });
  </script>
</body>
</html>
